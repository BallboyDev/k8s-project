# 쿠버네티스 기초 명령어 정리

- 쿠버네티스 모든 리소스 리스트
    - `kubectl api-resources`

- 기본 리소스 전체 조회
    - `kubectl get all`

- 리소스 조회
    - `kubectl get [pod | deployment | service | namespace | endpoints | configmap ...]`

- 리소스 상세 조회
    - `kubectl describe [리소스 종류] [리소스 이름]`

- 정의된 yaml 파일을 통해 리소스 생성 및 업데이트
    - `kubectl apply -f [파일명.yaml]`

- 리소스 삭제
    - `kubectl delete [deployment | service | configmap | secret ...] --all`

- 리소스 전체 삭제
    - 모든 디플로이먼트 삭제
        - `kubectl delete deploy --all`
    - 모든 서비스 삭제
        - `kubectl delete service --all`

- 파드 속 컨테이너 접근
    - `kubectl exec pod/[파드 이름] -- sh -c 'command'` / `kubectl exec pod/[파드 이름] -- command` 위 차이
        - `sh -c '...'` 방식
            - 쉘을 통해 간접 실행 방식
            - 비교적 효율성은 떨어지나 파이프, 리디레션, 여어 명령어 등의 쉘의 기능이 필요할 때 사용
        - `직접 실행 방식`
            - 쉘을 거치지 않고 쿠버네티스에서 리눅스 명령어를 실행
            - 쉘을 거치지 않기 때문에 효율성이 높고 복잡하지 않은 단일 명령어를 간단히 실행할 때 사용

    - 컨테이너 터미널 접근
        - `kubectl exec -it [파드 이름] -- sh`
        - `kubectl exec -it [파드 이름] -- /bin/bash`
    - 컨테이너 터미널 명령어 실행
        - `kubectl exec [파드 이름] -- sh -c 'ls -al /'`
        - `kubectl exec [파드 이름] -- sh -c 'printenv'`
    - 컨테이너 환경 변수 출력
        - `kubectl exec pod/[파드 이름] -- printenv`
    - 컨테이너 내부 명령어 실행
        - `kubectl exec pod/[파드 이름] -- sh -c 'command'`

- 컨피그맵 생성
    - 명령어로 컨피그맵 생성
        - `kubectl create configmap [configmap-name] --from-literal=[dataname]='value'`
    - 파일 기반으로 컨피그맵 생성 1
        - `kubectl create configmap [configmap-name] --from-env-file=[filepath]`
    - 파일 기반으로 컨피그맵 생성 2
        - `kubectl apply -f [파일명.yaml]`

- 파드 로그 출력
    - `kubectl logs [파드 이름]`

- 비밀값 생성
    - `kubectl create secret generic [secret-name] --from-literal=secret='value'`

- 비밀값 평문 확인
    - 인코딩 상태
        - `kubectl get secret [secret-name] -o jsonpath='{.data.secret}'`
    - 디코딩 상태
        - `kubectl get secret [secret-name] -o jsonpath='{.data.secret}' | base64 -d`
    - 비밀값 애너테이션에 저장된 내용 화인
        - `kubectl get secret [secret-name] -o jsonpath='{.metadata.annotations}'`

- 서비스 hostname 확인
    - `kubectl get service [service-name] -o jsonpath='{.status.loadBalancer.ingress[0]}'`

- 디프로이먼트 스케일링 변경
    - `kubectl scale --replicas=4 deploy/[deploy-name]`

- 디플로이먼트 롤아웃 히스토리 확인
    - `kubectl rollout history deploy/[deploy-name]`

- 파드 업데이트 상황 확인
    - `kubectl get pod --watch`

- 쿠버네티스 컨텍스의 목록을 확인
    - `kubectl config get-contexts`

- 현재 컨텍스트의 기본 네임스페이스 변경
    - `kubectl config set-context --current --namespace=[namespace-name]`


## Helm 명령어
- 헬름 설치
    - `brew install helm`

- 현재 네임스페이스의 헬름에 설치된 릴리즈 리스트 조회
    - `helm list` / `helm ls`
    - 모든 네임스페이스에의 릴리즈 조회
        - `helm list -A` / `helm list --all-namespaces`
    - 특정 네임스페이스 지정
        - `helm uninstall [release] -n [namespace-name]`

- 헬름 원격 서버 설정
    - `helm repo add [repo-name] [server-url]`
    - 공식 헬름 레포지토리 추가
        - `helm repo add stable https://charts.helm.sh/stable`

- 헬름에 등록된 원격서버 리스트
    - `helm repo list`

- 헬름 저장소 캐시 업데이트
    - `helm repo update`

- 설치 가능한 차트 정보 조회
    - `helm search repo [repo-name/chart-name]`
    - 설치 가능한 버전 리스트
        - `helm search repo [repo-name/chart-name] --versions`

- chart의 포함된 파라미터 값의 기본값 확인
    - `helm show values [repo-name/chart-name]`
    - `helm show values [repo-name/chart-name] --version [version-info]`

- chart 설치
    - `helm install [release-name] [repo-name]/[chart-name]`
    - `helm install --set [key]=[value] [release-name] [repo-name]/[chart-name] --version [version-info]`

- chart 설치 (설정값 파일화)
    - `helm install -f [value-file.yaml] [release-name] [repo-name]/[chart-name]`

- 릴리즈 업그레이드
    - 업그레이드시 파라미터 값을 명시하지 않으면 기존 릴리즈를 따라 가는 것이 아니라 차트에 작성된 기본 값을 따라 간다.
    - `helm upgrade --set [key]=[value] [repo-name] [release-name]`

- 차트 템플릿 생성
    - `helm create [chart-name]`

- 차트 템플릿 유효성 검증 (로컬에서 작업중인 차트에서만 사용 가능)
    - `helm lint [chart-name]`

- 차트 뮤지엄 설치 (차트 레포지토리 서버)
    - 차트 뮤지엄 공식 저장소 추가
        - `helm repo add chartmuseum https://chartmuseum.github.io/charts`
    - `helm install --set service.type=LoadBalancer --set service.externalPort=8008 --set env.open.DISABLE_API=false repo chartmuseum/chartmuseum`
        - `export SERVICE_HOST=$(kubectl get svc --namespace default repo-chartmuseum -o jsonpath='{.status.loadBalancer.ingress[0].hostname}')
  echo http://$SERVICE_HOST:8008/`

    - *헬름의 공식 저장소 stable 저장소는 더 이상 사용하지 않는다.*
        - `helm install --set service.type=LoadBalancer --set service.externalPort=8008 --set env.open.DISABLE_API=false repo stable/chartmuseum --version 2.13.0 --wait`

- 로컬 차트 패키징
    - `helm package [chart-name]`
    - 패키징 된 차트의 압축 파일을 차트뮤지엄에 업로드
        - `curl --data-binary "@[chart-name]" [repository-url]/api/chart`
        - `curl [repository-url]/index.yaml`


- 릴리즈의 현재 설정값을 확인
    - `helm get values [release-name]`
    - `helm get values [release-name] -o yaml > [file-name].yaml`

