# 개발 워크플로와 CI/CD

## 도커 개발 워크플로

### 개발 워크플로
1. 애플리케이션 개발
1. Dockerfile / docker-compose 파일 제작
1. 애플리케이션 이미지 빌드
    - 이미지 실행 테스트
1. 쿠버네티스 리소스 선언
1. 쿠버네티스 배치
    - 실행 테스트

### 업데이트 워크플로
1. 애플리케이션 수정 
1. 애플리케이션 이미지 빌드
    - 실행 테스트
1. 쿠버네티스 배치
    - 실행 테스트


## 쿠버네티스 개발 워크플로
- 쿠버네티스 중심의 개발 워크플로는 모든 테스트 환경과 CI/CD 서비스를 호스팅하는 클러스터를 운영하며 컨테이너 실행과 관련된 모든 일을 이 클러스터에 맡기는 것이다. 개발자 워크플로에서 모든 도커 아티팩트가 배제되므로 개발자는 애플리케이션 컴포넌트를 직접 다루며 애플리케이션 실행에 필요한 모든 요소를 로컬 컴퓨터에서 실행한다.
- 개발자가 변경 사항을 형상 관리 도구에 커밋하면 빌드가 일어나고, 이 빌드에서 컨테이너 이미지가 만들어져 레지스터리에 푸시된 후 새로운 버전의 애플리케이션이 클러스터 속 테스트 환경에 배치된다.

### 개발 워크플로
1. 개발자는 컨테이너를 이용하지 않고 작업하여 변경 사항을 깃 서버에 푸쉬한다.
1. 파이프라인에서는 도커나 빌드팩등을 사용하여 이미지를 빌드한다.
1. 빌드 절차는 깃 서버를 주시하다가 새로운 변경이 푸쉬되면 빌드 파이프라인을 실행한다. 빌드 파이프라인의 결과로 이미지가 빌드되고 레지스트리에 푸시된 후 클러스터에 애플리케이션이 배치된다.

- Buildkit
    - 빌드킷은 Dockerfile을 읽어 컨테이너 이미지를 만드는 과정을 담당하는 전문 엔진이다. 기존의 도커 빌드 엔진을 대체하기 위해 만들어 졌으며, 현재 최신 도커 버전에 기본으로 내장되어 있다.

## 컨텍스트와 네임스페이스를 이용하여 워크로드 분리하기

## 도커를 배제한 쿠버네티스의 지속적 전달
- 젠킨스 서버가 곡스 서버에서 애플리케이션 코드를 받아 오고, 빌드 킷 서버에서 컨테이너 이미지를 빌드하고, 빌드된 이미지를 레지스트리에 푸시한 후 최신 버전의 애플리케이션을 클러스터의 테스트 네임스페이스에 배치하는 과정